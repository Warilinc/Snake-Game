#pragma once
#include "ConsoleScreen.h"
#include "SCoord.h"
#include "Snake.h"
/// <summary>
/// Класс игры
/// </summary>
class CGame {
public:
    CGame(ConsoleScreen& _scr, int _width = 80, int _height = 24, int _latency = 120); //конструктор
    void game_loop();           // основной цикл игры
    bool once_more();           // вывод запроса и приём ответа от игрока
    void pak(int y);            // "Press any key for continue"
    void Settings();            //настройки игры
    void print_stat();          // напечатать статистику
    void Logo();                //вывести лого игры
    void bye();                 //вывести прощание


private:
    enum class Command { CMD_NOCOMMAND = 0, CMD_EXIT, CMD_LEFT, CMD_RIGHT, CMD_UP, CMD_DOWN, CMD_PLAY, CMD_2LEFT, CMD_2RIGHT, CMD_2UP, CMD_2DOWN,}; //команды игры
    enum class State { ST_OK, ST_EXIT, ST_DIED };  //состояния игры

    typedef std::pair<int, Command> CmdPair;

    int width, height;          //размеры поля
    int latency;                //задержка между действиями
    int SegmentsGet=3;          //колличество получаемых змейкой сегментов
    int FoodOnMap=1;            //колличество еды на поле
    bool borderless = true;    //режим без границ включен/выключен
    bool twoplayers = true;    //режим для двух игроков
    int winsPlayer1 = 0;        //победы 1 игрока
    int winsPlayer2 = 0;        //победы 2 игрока
    ConsoleScreen scr;                  //консоль
    CSnake snake, snake2;               //змейка
    CmdPair cmd_table[10];              //таблица комманд
    double duration_game, duration_game2;               //длительность игры
    double rating, rating_max=0.0, rating2, rating_max2 = 0.0;      //рейтинг и максимальный рейтинг
    WORD foodColor = 15;                //цвет еды
    WORD bdColor = 7;                   //цвет границ игрового поля
    WORD txtColor = 7;                  //цвет текста
    void draw_field();                  //нарисовать игровое поле
    SCoord make_food();                 //создать еду
    SCoord foodVect[5]{SCoord()};       //вектор координат еды
    Command get_command();              //получить и обработать комманду
};

